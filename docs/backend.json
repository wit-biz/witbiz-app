{
  "entities": {
    "Contact": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Contact",
      "type": "object",
      "description": "Represents a customer contact.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Contact entity."
        },
        "firstName": {
          "type": "string",
          "description": "The contact's first name."
        },
        "lastName": {
          "type": "string",
          "description": "The contact's last name."
        },
        "email": {
          "type": "string",
          "description": "The contact's email address.",
          "format": "email"
        },
        "phone": {
          "type": "string",
          "description": "The contact's phone number."
        },
        "company": {
          "type": "string",
          "description": "The contact's company."
        }
      },
      "required": [
        "id",
        "firstName",
        "lastName",
        "email"
      ]
    },
    "Lead": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Lead",
      "type": "object",
      "description": "Represents a sales lead.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Lead entity."
        },
        "contactId": {
          "type": "string",
          "description": "Reference to Contact. (Relationship: Contact 1:N Lead)"
        },
        "status": {
          "type": "string",
          "description": "The current status of the lead (e.g., New, Qualified, Contacted)."
        },
        "source": {
          "type": "string",
          "description": "The source of the lead (e.g., Website, Referral, Advertisement)."
        },
        "value": {
          "type": "number",
          "description": "The potential value of the lead."
        }
      },
      "required": [
        "id",
        "contactId",
        "status"
      ]
    },
    "Task": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Task",
      "type": "object",
      "description": "Represents a task assigned to a user.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Task entity."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N Task)"
        },
        "leadId": {
          "type": "string",
          "description": "Reference to Lead. (Relationship: Lead 1:N Task)"
        },
        "description": {
          "type": "string",
          "description": "A description of the task."
        },
        "dueDate": {
          "type": "string",
          "description": "The date the task is due.",
          "format": "date-time"
        },
        "completed": {
          "type": "boolean",
          "description": "Indicates whether the task has been completed."
        }
      },
      "required": [
        "id",
        "userId",
        "description",
        "dueDate",
        "completed"
      ]
    },
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the WitCRM system.  Note: Authentication information is not stored here.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the User entity."
        },
        "firstName": {
          "type": "string",
          "description": "User's first name."
        },
        "lastName": {
          "type": "string",
          "description": "User's last name."
        },
        "email": {
          "type": "string",
          "description": "User's email address.",
          "format": "email"
        }
      },
      "required": [
        "id",
        "firstName",
        "lastName",
        "email"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profiles.  Tasks and Contacts are owned by the user and accessible only to them.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/clients/{clientId}",
        "definition": {
          "entityName": "Client",
          "schema": {
            "$ref": "#/backend/entities/Contact"
          },
          "description": "Stores clients associated with a specific user.  Owned by the user.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            },
            {
              "name": "clientId",
              "description": "The unique identifier for the client."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/clients/{clientId}/leads/{leadId}",
        "definition": {
          "entityName": "Lead",
          "schema": {
            "$ref": "#/backend/entities/Lead"
          },
          "description": "Stores leads associated with a specific client. Owned by the user.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            },
            {
              "name": "clientId",
              "description": "The unique identifier for the client."
            },
            {
              "name": "leadId",
              "description": "The unique identifier for the lead."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/clients/{clientId}/leads/{leadId}/tasks/{taskId}",
        "definition": {
          "entityName": "Task",
          "schema": {
            "$ref": "#/backend/entities/Task"
          },
          "description": "Stores tasks associated with a specific lead. Owned by the user.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            },
            {
              "name": "clientId",
              "description": "The unique identifier for the client."
            },
            {
              "name": "leadId",
              "description": "The unique identifier for the lead."
            },
            {
              "name": "taskId",
              "description": "The unique identifier for the task."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to support WitCRM's core features: Contact Management, Lead Tracking, and Task Management. The structure prioritizes authorization independence, clarity, and scalability. User-owned data is stored under `/users/{userId}`. Contacts are also stored under each user to keep the application clear. Leads are nested under Contacts, and Tasks are nested under Leads to facilitate easy querying and management. This structure also provides clear ownership and simplifies security rules.\n\n**Authorization Independence:**  Authorization is enforced at each level using path-based rules and explicit ownership. This avoids relying on `get()` calls in security rules, ensuring atomic operations and easier debugging.\n\n**QAPs Support:**  The structure supports secure list operations by segregating data based on ownership. Each user's data is stored under their respective `/users/{userId}` path, ensuring that only the user can access their contacts, leads, and tasks. The nested structure further simplifies querying and ensures that listing operations are scoped to the correct user and resource (e.g., listing all leads for a specific contact).\n\nHomogeneous security posture for Tasks and Leads is achieved by nesting them under their respective owners."
  }
}