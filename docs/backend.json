{
  "entities": {
    "Contact": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Contact",
      "type": "object",
      "description": "Represents a customer contact.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Contact entity."
        },
        "firstName": {
          "type": "string",
          "description": "The first name of the contact."
        },
        "lastName": {
          "type": "string",
          "description": "The last name of the contact."
        },
        "email": {
          "type": "string",
          "description": "The email address of the contact.",
          "format": "email"
        },
        "phone": {
          "type": "string",
          "description": "The phone number of the contact."
        },
        "company": {
          "type": "string",
          "description": "The company the contact works for."
        }
      },
      "required": [
        "id",
        "firstName",
        "lastName",
        "email"
      ]
    },
    "Lead": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Lead",
      "type": "object",
      "description": "Represents a sales lead.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Lead entity."
        },
        "contactId": {
          "type": "string",
          "description": "Reference to Contact. (Relationship: Contact 1:N Lead)"
        },
        "status": {
          "type": "string",
          "description": "The current status of the lead (e.g., New, Qualified, Opportunity, Customer)."
        },
        "source": {
          "type": "string",
          "description": "The source of the lead (e.g., Website, Referral, Advertisement)."
        },
        "estimatedValue": {
          "type": "number",
          "description": "The estimated value of the lead."
        }
      },
      "required": [
        "id",
        "contactId",
        "status"
      ]
    },
    "Task": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Task",
      "type": "object",
      "description": "Represents a task to be completed.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Task entity."
        },
        "leadId": {
          "type": "string",
          "description": "Reference to Lead. (Relationship: Lead 1:N Task)"
        },
        "assignedTo": {
          "type": "string",
          "description": "The user ID of the person assigned to the task."
        },
        "description": {
          "type": "string",
          "description": "A description of the task."
        },
        "dueDate": {
          "type": "string",
          "description": "The date the task is due.",
          "format": "date-time"
        },
        "completed": {
          "type": "boolean",
          "description": "Whether the task is completed or not."
        }
      },
      "required": [
        "id",
        "leadId",
        "assignedTo",
        "description",
        "dueDate"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}/contacts/{contactId}",
        "definition": {
          "entityName": "Contact",
          "schema": {
            "$ref": "#/backend/entities/Contact"
          },
          "description": "Stores contact information for a user. Path-based ownership ensures only the user can access their contacts.",
          "params": [
            {
              "name": "userId",
              "description": "The ID of the user who owns the contact."
            },
            {
              "name": "contactId",
              "description": "The ID of the contact."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/leads/{leadId}",
        "definition": {
          "entityName": "Lead",
          "schema": {
            "$ref": "#/backend/entities/Lead"
          },
          "description": "Stores lead information for a user. Path-based ownership ensures only the user can access their leads.",
          "params": [
            {
              "name": "userId",
              "description": "The ID of the user who owns the lead."
            },
            {
              "name": "leadId",
              "description": "The ID of the lead."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/leads/{leadId}/tasks/{taskId}",
        "definition": {
          "entityName": "Task",
          "schema": {
            "$ref": "#/backend/entities/Task"
          },
          "description": "Stores task information for a lead. Path-based ownership ensures only the user can access their tasks.",
          "params": [
            {
              "name": "userId",
              "description": "The ID of the user who owns the lead."
            },
            {
              "name": "leadId",
              "description": "The ID of the lead."
            },
            {
              "name": "taskId",
              "description": "The ID of the task."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to support WitCRM's core features: Contact, Lead, and Task Management. It prioritizes authorization independence, clarity, and scalability. User-owned data is stored under the `/users/{userId}` path, ensuring clear ownership and straightforward security rules. Collaborative access is not required based on the user request, so a simple path based approach will suffice.  The structure avoids hierarchical authorization dependencies, enabling atomic operations.  Each collection is designed with a homogeneous security posture, meaning all documents within a collection share the same security requirements.  This facilitates secure `list` operations (QAPs) because rules don't need to act as filters.  Denormalization is applied where appropriate to enforce authorization independence."
  }
}